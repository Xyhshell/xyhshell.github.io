<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Bing(必应)每日一图下载 | Code blog</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://xyhshell.github.io/favicon.ico?v=1653288973771">
<link rel="stylesheet" href="https://xyhshell.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4VZ5G7WQH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S4VZ5G7WQH');
</script>


    <meta name="description" content="一款更新windows桌面壁纸软件

1.环境 &amp; 声明
python 3.7.5(32bit) 兼容32和64位系统
交流与分享，请勿用于非法途径
2.灵感 &amp; 说明

得益于一个偶然的浏览，发现有博主利用php实现对必应..." />
    <meta name="keywords" content="编码" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://xyhshell.github.io">
        <img src="https://xyhshell.github.io/images/avatar.png?v=1653288973771" class="site-logo">
        <h1 class="site-title">Code blog</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://xyhshell.github.io" class="site-nav">
            首页
          </a>
        
      
        
          <a href="https://xyhshell.github.io/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="https://xyhshell.github.io/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="https://xyhshell.github.io/post/About" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
  
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/xyhshell" target="_blank">
            <i class="fab fa-github"></i>
          </a>

		<a class="rss" href="https://xyhshell.github.io/atom.xml" target="_blank">RSS</a>
		
        
      
        
      
        
      
        
      
        
      
    </div>
    
    <div class="site-description">
      敬畏自然，技术至上
    </div>
    
    <div class="site-footer">
      ❤️ 希望你能好好的 To you ! ❤️ <br><br>  Copyrights © 2021-2022 <a href="https://github.com/xyhshell" target="_blank">Jingmo - Xiao</a>
    </div>
    
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Bing(必应)每日一图下载</h2>
            <div class="post-date">2021-09-21</div>
            
            <div class="post-content" v-pre>
              <p>一款更新windows桌面壁纸软件</p>
<!-- more -->
<h1 id="1环境-声明">1.环境 &amp; 声明</h1>
<p>python 3.7.5(32bit) 兼容32和64位系统</p>
<h2 id="交流与分享请勿用于非法途径">交流与分享，请勿用于非法途径</h2>
<h1 id="2灵感-说明">2.灵感 &amp; 说明</h1>
<blockquote>
<p>得益于一个偶然的浏览，发现有博主利用php实现对必应每日一图的解析和获取，于是利用python对其进行复现（虽然有可直接用的接口，而毕竟是别人的！😥）,并添加一定的功能！</p>
</blockquote>
<blockquote>
<p>21/06/04 ：初代版本 ，提供图片下载并可自定义设为壁纸.</p>
<blockquote>
<p>21/07/06 : 期间太忙，后续使用中发现代码过于臃肿，控制窗口显示非必要信息过多，精简并添加对图片信息和链接文件的储存！</p>
</blockquote>
</blockquote>
<h1 id="正片开始">正片开始</h1>
<blockquote>
<p>首先是<a href="https://tool.liumingye.cn/bingimg/">博主</a>提供的php版解析接口，使用要求较高，尤其是环境的搭建。</p>
</blockquote>
<pre><code class="language-php">&lt;?php
/*
    * @author www.liumingye.cn
*/
$filename = &quot;./cache.json&quot;;
if (file_exists($filename) === false) {
    file_put_contents($filename, &quot;&quot;);
}
$handle = fopen($filename, &quot;r&quot;);
$contents = fread($handle, filesize($filename));
fclose($handle);
$contents = json_decode($contents, true);

if (filesize($filename) === 0) {
    // echo &quot;获取\r\n&quot;;
    getBingImg();
} else {
    if ($contents['time'] === date(&quot;Ymd&quot;)) {
        // echo &quot;缓存\r\n&quot;;
        Header(&quot;Location: &quot;.$contents['url']);
    } else {
        // echo &quot;过期\r\n&quot;;
        getBingImg();
    }
}
function getBingImg() {
    $str = file_get_contents('http://cn.bing.com/HPImageArchive.aspx?idx=0&amp;n=1');
    if (preg_match(&quot;/&lt;url&gt;(.+?)&lt;\/url&gt;/ies&quot;, $str, $matches)) {
        $imgurl = 'https://cn.bing.com' . $matches[1];
    }
    if ($imgurl) {
        global $contents;
        if($contents['url'] !== $imgurl){
            global $filename;
            $data = array(
                &quot;time&quot; =&gt; date(&quot;Ymd&quot;) ,
                &quot;url&quot; =&gt; $imgurl
            );
            $data = json_encode($data);
            file_put_contents($filename, $data);
        }
        Header(&quot;Location: &quot;.$imgurl);
        exit();
    } else {
        exit('error');
    }
}
</code></pre>
<h1 id="202164-bing_lym项目源码">2021/6/4/ bing_lym项目源码</h1>
<blockquote>
<p>尚有优化，待优化……</p>
</blockquote>
<pre><code class="language-python">#!/usr/bin/python
# -*- coding:utf-8 -*-
# @File   : bing_lym.py
# @Time   : 2021/6/4 8:53

import re
import os
import win32api
import win32con
import win32gui
import requests

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36'
}
''


def downloads_img(time_info, img_d_url, img_text):
    path = os.getcwd() + f'/{time_info}.jpg'
    with open(path, 'wb') as f:
        f.write(requests.get(img_d_url, headers=headers).content)

    path_ = os.getcwd() + f'/{time_info}.txt'
    with open(path_, 'w', encoding='utf-8') as f_:
        f_.write(img_text + '\n' + img_d_url)

    print(&quot;*-&gt; 文件链接&quot;, img_d_url)
    print(f&quot;*-&gt; 文件  {time_info}.jpg --&gt; 下载成功！&quot;)


def get_res_html():
    aspx_url = 'http://cn.bing.com/HPImageArchive.aspx?idx=0&amp;n=1'
    img_html = requests.get(url=aspx_url, headers=headers).text
    # print(img_html)

    date_info = re.findall('&lt;fullstartdate&gt;(.*?)&lt;/fullstartdate&gt;', img_html)[0]
    img_info = re.findall('&lt;url&gt;(.*?)&lt;/url&gt;', img_html)[0]

    # 07_06 加入关于图片说明
    img_text = re.findall('&lt;copyright&gt;(.*?)&lt;/copyright&gt;', img_html)[0]
    print(' date_info -&gt; %s\n img_info  -&gt; %s\n img_text  -&gt; %s' % (date_info, img_info, img_text))

    return date_info, img_info, img_text


def setWallPaper(pic):
    # open register
    regKey = win32api.RegOpenKeyEx(win32con.HKEY_CURRENT_USER, &quot;Control Panel\\Desktop&quot;, 0, win32con.KEY_SET_VALUE)
    win32api.RegSetValueEx(regKey, &quot;WallpaperStyle&quot;, 0, win32con.REG_SZ, &quot;2&quot;)
    win32api.RegSetValueEx(regKey, &quot;TileWallpaper&quot;, 0, win32con.REG_SZ, &quot;0&quot;)
    # refresh screen
    win32gui.SystemParametersInfo(win32con.SPI_SETDESKWALLPAPER, pic, win32con.SPIF_SENDWININICHANGE)


def img_main():
    bing_url = 'https://cn.bing.com'
    date_info, img_info, img_text = get_res_html()
    # 下载函数
    downloads_img(time_info=date_info, img_d_url=bing_url + img_info, img_text=img_text)
    # 绝对路径储存
    path = os.getcwd() + f'/{date_info}.jpg'
    # print(type(path), path)

    pd = input('&gt; 更换壁纸？ y/n :')
    if pd == &quot;y&quot; or &quot;Y&quot;:
        setWallPaper(pic=path)
    else:
        pass


if __name__ == '__main__':
    img_main()
</code></pre>
<hr>
<h1 id="文件地址">文件地址</h1>
<p>码云：https://gitee.com/xyhshell/bing_lym<br>
成品可执行文件：https://jingmo.lanzoui.com/ida7Ur2z33a</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://xyhshell.github.io/tag/bian-ma/" class="tag">
                    编码
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://xyhshell.github.io/post/beyond/">
                  <h3 class="post-title">
                    名人传（黄家驹 &amp; beyond）
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
